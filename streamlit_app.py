import streamlit as st
import openai

# ×”×’×“×¨ ××ª ××¤×ª×— ×”Ö¾API ×©×œ×š ×›××Ÿ ××• ×“×¨×š ×”×’×“×¨×•×ª ×¡×‘×™×‘×ª×™×•×ª
openai.api_key = st.secrets.get("OPENAI_API_KEY")

st.set_page_config(page_title="×‘×Ÿ ×™×”×•×™×“×¢ ××™× ×˜×¨××§×˜×™×‘×™", layout="wide")

# --- ×›×•×ª×¨×ª ×¨××©×™×ª ---
st.title("ğŸ“– ×‘×Ÿ ×™×”×•×™×“×¢ â€“ ×¡× ×”×“×¨×™×Ÿ ×§×´×— ×¢×´×‘")
st.markdown("### ×¢×™×•×Ÿ ×•×œ×™××•×“ ×¢× ×¤×¨×©× ×•×ª ×—×™×”")

# --- ×§×˜×¢ ××”×¡×¤×¨ ---
ben_yehoyada_text = """
**××•×¨×©×™× ×** â€“ ×¢×•×£ ×•×©××• "×—×•×œ", ×‘×œ×©×•×Ÿ ×”××§×¨×, ×•××™× ×• ××ª ×œ×¢×•×œ×.  
×××¨ ×œ×• × ×—: ××“×•×¢ ××™× ×š ××•×›×œ?  
×××¨ ×œ×•: ×¨××™×ª×™ ××•×ª×š ×˜×¨×•×“, ×•×œ× ×¨×¦×™×ª×™ ×œ×”×˜×¨×™×— ××•×ª×š.  
×××¨ ×œ×•: ×™×”×™ ×¨×¦×•×Ÿ ×©×œ× ×ª××•×ª ×œ×¢×•×œ×.

ğŸ‘‰ ××›××Ÿ ×œ××“× ×•: ××™×“×” ×©×œ ×¢× ×•×•×” ×•×”×ª×—×©×‘×•×ª ×™×›×•×œ×” ×œ×”×¢× ×™×§ ×—×™×™× ××¢×‘×¨ ×œ×’×‘×•×œ×•×ª ×”×˜×‘×¢.
"""

with st.expander("ğŸ“œ ×§×˜×¢ ××ª×•×š ×‘×Ÿ ×™×”×•×™×“×¢"):
    st.markdown(ben_yehoyada_text)

# --- ×ª×™×‘×ª ×©×™×—×” ×¢× GPT ---
st.markdown("---")
st.markdown("### ğŸ¤– ×©××œ ××ª ×‘×Ÿ ×™×”×•×™×“×¢")

user_question = st.text_input("××” ×ª×¨×¦×” ×œ×©××•×œ ×¢×œ ×”×§×˜×¢ ×”×–×”?", placeholder="×œ××” ×“×•×•×§× ×¢× ×•×•×” ××–×›×” ×‘×—×™×™ × ×¦×—?")

if user_question:
    with st.spinner("×—×•×©×‘ ×™×—×“ ××™×ª×š..."):
        prompt = f"""
        ××ª×” ×¤×¨×©×Ÿ ×—×›× ×•×¨×’×™×©, ×”××ª××—×” ×‘×¤×™×¨×•×© ××’×“×•×ª ×—×–×´×œ. ×§×™×‘×œ×ª ××ª ×”×§×˜×¢ ×”×‘× ××ª×•×š ×¡×¤×¨ '×‘×Ÿ ×™×”×•×™×“×¢' ×¢×œ ×¡× ×”×“×¨×™×Ÿ ×§×´×— ×¢×´×‘:

        {ben_yehoyada_text}

        ×•×”×©××œ×” ×©× ×©××œ×” ×”×™×:
        {user_question}

        ×”×©×‘ ×ª×©×•×‘×” ××¢××™×§×”, ×‘×”×™×¨×”, ×¢× × ×’×™×¢×” ××•×¡×¨×™×ª ××• ×§×‘×œ×™×ª ×œ×¤×™ ×”×”×§×©×¨.
        """
        try:
            response = openai.ChatCompletion.create(
                model="gpt-4",
                messages=[
                    {"role": "system", "content": "You are a wise and empathetic Talmudic commentator."},
                    {"role": "user", "content": prompt}
                ],
                temperature=0.7,
                max_tokens=500
            )
            answer = response["choices"][0]["message"]["content"]
            st.markdown("#### âœ¨ ×ª×©×•×‘×”:")
            st.markdown(answer)
        except Exception as e:
            st.error("×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× OpenAI. ×•×“× ×©××¤×ª×— ×”Ö¾API ×©×œ×š ×ª×§×™×Ÿ.")
Add streamlit app
